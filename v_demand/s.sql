SELECT
    "Идентификатор пациента",
    "МО заявки",
    "ФИО",
    "Дата рождения",
    "Дата смерти",
    STRING_AGG(DISTINCT "Заявка", ', ') AS "План-Доп",
    CASE
        WHEN COUNT(DISTINCT "План-Доп") = 2 THEN 'Да'  -- Если есть и "ПЛАН", и "ДОП"
        ELSE 'Нет'  -- В противном случае
    END AS "Имеет план и доп"
from v_demand
WHERE "Год" = '2025'

GROUP BY
    1,2,3,4,5;
